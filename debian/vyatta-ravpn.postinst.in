#!/bin/bash

prefix=@prefix@
exec_prefix=@exec_prefix@
sysconfdir=@sysconfdir@
bindir=@bindir@
sbindir=@sbindir@

# remove init of daemons that we start/stop
for init in xl2tpd pptpd; do
  update-rc.d -f ${init} remove >/dev/null
done

for cfg in /etc/ipsec.d/tunnels/remote-access \
           /etc/radiusclient-ng/radiusclient-pptp.conf \
           /etc/radiusclient-ng/servers-pptp \
           /etc/radiusclient-ng/radiusclient-l2tp.conf \
           /etc/radiusclient-ng/servers-l2tp \
           /etc/radiusclient-ng/port-id-map-ravpn \
           /etc/ppp/options.xl2tpd \
           /etc/ppp/options.pptpd; do
  mkdir -p ${cfg%/*}
  touch $cfg
done

cp -f ${sysconfdir}/ravpn/radius-dictionary.microsoft \
  /etc/radiusclient-ng/dictionary.microsoft
cp -f /etc/radiusclient-ng/dictionary /etc/radiusclient-ng/dictionary-ravpn
echo 'INCLUDE /etc/radiusclient-ng/dictionary.merit' \
  >> /etc/radiusclient-ng/dictionary-ravpn
echo 'INCLUDE /etc/radiusclient-ng/dictionary.microsoft' \
  >> /etc/radiusclient-ng/dictionary-ravpn

mkdir -p ${sysconfdir}/ravpn/sessions

for auth in auth-up auth-down; do
  [ -f /etc/ppp/$auth ] && [ ! -f /etc/ppp/$auth.vyatta-save ] \
    && mv -f /etc/ppp/$auth /etc/ppp/$auth.vyatta-save
  cp -f ${sysconfdir}/ravpn/ppp-$auth /etc/ppp/$auth
done

